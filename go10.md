---
title: "Goï¼ˆåï¼‰å‡½æ•°"
date: 2023-03-09T18:17:27+08:00
# draft: true
tags: ["golang"]
categories: ["notes"]
---
<!-- TOC -->

- [å‡½æ•°å®šä¹‰](#%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89)
- [å‚æ•°ä¼ é€’](#%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92)
- [ä½œç”¨åŸŸ](#%E4%BD%9C%E7%94%A8%E5%9F%9F)
- [å‡½æ•°çš„é€’å½’](#%E5%87%BD%E6%95%B0%E7%9A%84%E9%80%92%E5%BD%92)
- [åŒ…](#%E5%8C%85)
- [initå‡½æ•°](#init%E5%87%BD%E6%95%B0)
- [åŒ¿åå‡½æ•°](#%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0)
- [é—­åŒ…](#%E9%97%AD%E5%8C%85)
- [å‡½æ•°çš„defer](#%E5%87%BD%E6%95%B0%E7%9A%84defer)
- [æ—¶é—´ç›¸å…³å‡½æ•°](#%E6%97%B6%E9%97%B4%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0)
- [å†…ç½®å‡½æ•°](#%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0)
- [é”™è¯¯å¤„ç† defer panic recover](#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86-defer-panic-recover)
- [ç»ƒä¹ ](#%E7%BB%83%E4%B9%A0)
    - [æ–æ³¢é‚£å¥‘æ•°åˆ—ğŸ‘‡](#%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97)
    - [çŒ´å­åƒæ¡ƒé—®é¢˜ï¼ˆé€’å½’ï¼‰](#%E7%8C%B4%E5%AD%90%E5%90%83%E6%A1%83%E9%97%AE%E9%A2%98%E9%80%92%E5%BD%92)
    - [makeSuffixsuffix stringé—­åŒ…](#makesuffixsuffix-string%E9%97%AD%E5%8C%85)

<!-- /TOC -->
## å‡½æ•°å®šä¹‰
å®ŒæˆæŸä¸€åŠŸèƒ½çš„ç¨‹åºæŒ‡ä»¤çš„é›†åˆ
```dotnetcli
func å‡½æ•°å(å½¢å‚åˆ—è¡¨)(è¿”å›å€¼åˆ—è¡¨){
    æ‰§è¡Œè¯­å¥
    return è¿”å›å€¼åˆ—è¡¨
}
```
returnè¯­å¥å¯ä»¥çœç•¥ï¼Œä¹Ÿå¯ä»¥è¿”å›å¤šä¸ªå€¼ã€‚
<!--more-->
## å‚æ•°ä¼ é€’

- å€¼ä¼ é€’ï¼šæ‹·è´å‰¯æœ¬
- å¼•ç”¨ä¼ é€’ï¼šæ‹·è´åœ°å€ã€‚æ•ˆç‡é«˜ï¼Œæ•°æ®é‡å°ã€‚
- å€¼ç±»å‹ï¼šåŸºæœ¬æ•°æ®ç±»å‹intç³»åˆ—ï¼Œfloatã€boolã€stringã€æ•°ç»„ã€struct
- å¼•ç”¨ç±»å‹ï¼šæŒ‡é’ˆã€åˆ‡ç‰‡ã€mapã€ç®¡é“chanã€interface
- å¯å˜å‚æ•°
```go
func sum(n1 int, n2 ...int) {
	res := 0
	res += n1
	for i := 0; i < len(n2); i++ {
		res += n2[i]
	}
	fmt.Printf("res=%v\n", res)
}
func main() {
	sum(1, 2, 3)
	var arr = []int{2, 3, 4, 5}
	sum(1, arr...)
}
```
## ä½œç”¨åŸŸ
- å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡å«å±€éƒ¨å˜é‡ï¼Œä½œç”¨åŸŸä»…é™äºå‡½æ•°å†…éƒ¨ã€‚
- å‡½æ•°å¤–å£°æ˜çš„å«å…¨å±€å˜é‡ï¼Œä½œç”¨åŸŸå†æ•´ä¸ªåŒ…æœ‰æ•ˆã€‚å¦‚æœé¦–å­—æ¯å¤§å†™ï¼Œåˆ™ä½œç”¨åŸŸåœ¨æ•´ä¸ªç¨‹åºæœ‰æ•ˆ

## å‡½æ•°çš„é€’å½’
ä¸€ä¸ªå‡½æ•°è°ƒç”¨è‡ªå·±ï¼Œç§°ä¸ºé€’å½’ã€‚
```go
func test01(n int) {
	if n > 2 {
		n--
		test01(n)
	} else {
		fmt.Printf("n<2,n=%v\n", n)
	}
}
func main() {
	test01(5)
}
```
- é€’å½’å‡½æ•°çš„å±€éƒ¨å˜é‡æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šäº’ç›¸å½±å“
- é€’å½’æœ‰ç»ˆæ­¢æ¡ä»¶


## åŒ…
- åŒºåˆ†ç›¸åŒåå­—çš„å‡½æ•°ã€å˜é‡ç­‰æ ‡å¿—ç¬¦
- å½“æ–‡ä»¶å¾ˆå¤šæ—¶å¯ä»¥å¾ˆå¥½çš„ç®¡ç†é¡¹ç›®
- æ§åˆ¶å‡½æ•°å˜é‡ç­‰ä½œç”¨åŸŸ
- åŒ…åä¸€èˆ¬ç”¨å°å†™å­—æ¯
- å¯¼å…¥ `import "åŒ…è·¯å¾„"`
```dotnetcli
demo
 - main
    - main.go
 - utils
    - utils.go
```
utils.go
```go
package utils

func Add(a, b int) int {
	return a + b
}

```
main.go
```go
package main

import (
	"fmt"
	"demo/utils"
)
func main() {
	a, b := 1, 2
	fmt.Println(utils.Add(a, b))

}
```
åŒ…åæ”¯æŒå–åˆ«åã€‚å–äº†åˆ«ååˆ™éœ€è¦ä½¿ç”¨åˆ«åæ¥è®¿é—®å‡½æ•°å’Œå˜é‡
```go
package main

import (
	"fmt"
	u "go-learning/utils"
)

func main() {
	a, b := 1, 2
	fmt.Println(u.Add(a, b))

}
```
## initå‡½æ•°
æ¯ä¸ªæºæ–‡ä»¶éƒ½å¯ä»¥åŒ…å«ä¸€ä¸ªinitå‡½æ•°ï¼Œä¼šåœ¨mainå‡½æ•°ä¹‹å‰è¢«è°ƒç”¨ã€‚å¯ä»¥ç”¨æ¥å®Œæˆä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚
```go
func init() {
	fmt.Println("call init ..")
}
func main() {
	fmt.Println("call main...")
}
```
è¾“å‡º

```powershell
call init ..
call main...
```
## åŒ¿åå‡½æ•°
å®šä¹‰æ—¶å°±ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½è°ƒç”¨ä¸€æ¬¡
```go
res := func(a, b int) int {
    return a + b
}(1, 2)
fmt.Println(res)
```

## é—­åŒ…
ä¸€ä¸ªå‡½æ•°å’Œä¸å…¶ç›¸å…³çš„å¼•ç”¨ç¯å¢ƒç»„æˆçš„ä¸€ä¸ªæ•´ä½“

```go
func AddUpper() func(int) int {
	var n int = 10
	return func(i int) int {
		n += i
		return n
	}
}

func main() {
	f := AddUpper()
	fmt.Println(f(1)) //11
	fmt.Println(f(2)) //13
}
```
- è¿”å›ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå¼•ç”¨åˆ°å‡½æ•°å¤–çš„å˜é‡n
- `f := AddUpper()`åˆå§‹åŒ–nï¼Œä»…ç”Ÿæˆä¸€æ¬¡
- é—­åŒ…å¯ä»¥è¿”å›ä¸Šæ¬¡å¼•ç”¨çš„æŸå€¼

## å‡½æ•°çš„defer
deferï¼Œç”¨äºå‡½æ•°æ‰§è¡Œå®Œï¼ŒåŠæ—¶é‡Šæ”¾èµ„æºã€‚å¦‚æ•°æ®åº“è¿æ¥ã€æ–‡ä»¶å¥æŸ„ã€æ–‡ä»¶é”ç­‰
```go
func sum(n1, n2 int) int {
	defer fmt.Printf("n1=%v\n", n1)
	defer fmt.Printf("n2=%v\n", n2)
	n1++
	n2++
	res := n1 + n2
	fmt.Printf("n1=%v,n2=%v,res=%v\n", n1, n2, res)
	return res
}
func main() {
	sum(6, 60)
}
```
è¾“å‡º
```powershell
n1=7,n2=61,res=68
n2=60
n1=6
```
- deferä¸ä¼šç«‹åˆ»æ‰§è¡Œï¼Œè€Œæ˜¯å°†deferåçš„è¯­å¥å‹å…¥ä¸€ä¸ªæ ˆï¼Œç„¶åç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªå‡½æ•°è¯­å¥ã€‚
- å‡½æ•°æ‰§è¡Œå®Œï¼Œä»deferçš„æ ˆä¸­ï¼Œä¾æ¬¡ä»æ ˆé¡¶å–å‡ºæ‰§è¡Œï¼ˆå…ˆå…¥åå‡ºåŸåˆ™ï¼‰
- deferè¯­å¥å…¥æ ˆï¼Œä¹Ÿä¼šå°†ç›¸å…³çš„å€¼æ‹·è´å…¥æ ˆã€‚

## æ—¶é—´ç›¸å…³å‡½æ•°
```go
now := time.Now()
str := fmt.Sprintf("%d-%d-%d %d:%d:%d", now.Year(), now.Month(), now.Day(), now.Hour(), now.Minute(), now.Second())
fmt.Println(str)

fmt.Printf(now.Format("2006-01-02 15:04:05") + "\n")
fmt.Print(now.Format("2006-01-02") + "\n")

fmt.Printf("å•ä½ç§’Unix:%v\n", now.Unix())
fmt.Printf("å•ä½çº³ç§’UnixNano:%v\n",now.UnixNano())
```
`2006-01-02 15:04:05`å­—ç¬¦ä¸²æ•°å›ºå®šçš„

## å†…ç½®å‡½æ•°

å†…ç½®å‡½æ•° | æè¿°
---------|----------
 close | ä¸»è¦ç”¨æ¥å…³é—­channel
 len | æ±‚é•¿åº¦
 new | åˆ†é…å†…å­˜ã€‚ä¸»è¦ç”¨æ¥åˆ†é…å€¼ç±»å‹ï¼Œæ¯”å¦‚intã€structï¼Œè¿”å›çš„æ˜¯æŒ‡é’ˆ
 make | åˆ†é…å†…å­˜ã€‚ä¸»è¦ç”¨æ¥åˆ†é…å¼•ç”¨ç±»å‹ï¼Œæ¯”å¦‚chanã€mapã€slice
 append | ç”¨æ¥è¿½åŠ å…ƒç´ åˆ°æ•°ç»„ã€sliceä¸­
 panicå’Œrecover | ç”¨æ¥å¤„ç†é”™è¯¯

## é”™è¯¯å¤„ç† defer panic recover
é»˜è®¤æƒ…å†µä¸‹ï¼Œç¨‹åºå‘ç”Ÿé”™è¯¯ï¼ˆpanicï¼‰ä¹‹åï¼Œå°±ä¼šé€€å‡ºã€‚å‘ç”Ÿé”™è¯¯ä¹‹åï¼Œå¯ä»¥æ•è·é”™è¯¯ï¼Œè¿›è¡Œå¤„ç†ï¼Œä¿è¯ç¨‹åºå¯ä»¥ç»§ç»­è¿è¡Œã€‚
```go
func div(n1, n2 int) {
	defer func() {
		err := recover()
		if err != nil {
			fmt.Printf("err=%v\n", err)
			fmt.Println("å‘é€å‘Šè­¦é‚®ä»¶ç»™ç®¡ç†å‘˜ã€‚ã€‚")
		}
	}()
	res := n1 / n2
	fmt.Printf("%v/%v=%v\n", n1, n2, res)
}
func main() {
	div(6, 0)
}
```

è‡ªå®šä¹‰é”™è¯¯
```go
import (
	"errors"
	"fmt"
)

func readConf(name string) (err error) {
	if name != "config.ini" {
		return errors.New("è¯»å–é…ç½®æ–‡ä»¶é”™è¯¯ã€‚ã€‚")
	}
	return nil
}

func main() {
	err := readConf("test")
	if err != nil {
		panic("err=%v\n", err)
	}
}
```
æ³¨ï¼š
- panicå¯ä»¥å†ä»»ä½•åœ°æ–¹å¼•å‘ï¼Œrecoveråªæœ‰åœ¨deferè°ƒç”¨çš„å‡½æ•°ä¸­æœ‰æ•ˆ
- deferä¸€å®šè¦åœ¨å¯èƒ½å¼•å‘panicçš„è¯­å¥ä¹‹å‰å®šä¹‰

## ç»ƒä¹ 
### æ–æ³¢é‚£å¥‘æ•°åˆ—ğŸ‘‡
1,1,2,3,5,8,13,21,34,55....    
ç¬¬ä¸€ä¸ªæ•°å’Œç¬¬äºŒä¸ªæ•°ä¸º1,ç¬¬ä¸‰ä¸ªæ•°å¼€å§‹ä¸ºå‰é¢ä¸¤ä¸ªæ•°çš„å’Œã€‚
```go
func fbn(n int) int {
	if n == 1 || n == 2 {
		return 1
	}
	return fbn(n-1) + fbn(n-2)
}

func main() {
	fmt.Println(fbn(10))

}
```
### çŒ´å­åƒæ¡ƒé—®é¢˜ï¼ˆé€’å½’ï¼‰
æœ‰ä¸€å †æ¡ƒå­ï¼ŒçŒ´å­ç¬¬ä¸€å¤©åƒäº†å…¶ä¸­çš„ä¸€åŠï¼Œå¹¶ä¸”å¤šåƒäº†ä¸€ä¸ªã€‚ä»¥åçŒ´å­æ¯å¤©éƒ½åƒå…¶ä¸­çš„ä¸€åŠï¼Œå†å¤šåƒä¸€ä¸ªã€‚å½“åˆ°ç¬¬åå¤©æ—¶ï¼Œå‘ç°åªæœ‰ä¸€ä¸ªæ¡ƒå­äº†ã€‚  
é—®é¢˜ï¼šæœ€åˆæ€»å…±æœ‰å¤šå°‘ä¸ªæ¡ƒå­ï¼Ÿ
```go
func peach(n int) int {
	if n == 10 {
		return 1
	}
	if n <= 0 || n > 10 {
		fmt.Println("è¾“å…¥å¤©æ•°ä¸å¯¹ï¼Œä»…æ”¯æŒ1 ~ 10")
		return 0
	}
	return 2 * (peach(n+1) + 1)

}

func main() {
	fmt.Println(peach(1))

}
```

### makeSuffix(suffix string)é—­åŒ…
- æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶åï¼Œå¹¶è¿”å›ä¸€ä¸ªé—­åŒ…
- è°ƒç”¨é—­åŒ…ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶åï¼Œå¦‚æœè¯¥æ–‡ä»¶åæ²¡æœ‰æŒ‡å®šçš„åç¼€ï¼ˆå¦‚.jpgï¼‰ï¼Œåˆ™è¿”å›"æ–‡ä»¶å.jpg"ï¼Œå¦‚å·²ç»æœ‰åç¼€ï¼Œåˆ™è¿”å›åŸæ–‡ä»¶å
```go
func makeSuffix(suffix string) func(string) string {
	return func(filename string) string {
		if strings.HasSuffix(s, suffix) {
			return filename
		}
		return filename + suffix
	}
}
func main() {
	m := makeSuffix(".jpg")
	fmt.Println(m("111"))   //111.jpg
	fmt.Println(m("test.jpg"))  // test.jpg
}
```